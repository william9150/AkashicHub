<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AkashicHub é€£æ¥æ¸¬è©¦</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .success {
        color: #67c23a;
        background: #f0f9ff;
        padding: 15px;
        border-radius: 5px;
        border-left: 4px solid #67c23a;
      }
      .info {
        color: #409eff;
        background: #ecf5ff;
        padding: 15px;
        border-radius: 5px;
        border-left: 4px solid #409eff;
      }
      .test-item {
        margin: 10px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
      }
      .status {
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 3px;
        color: white;
      }
      .status.ok {
        background: #67c23a;
      }
      .status.error {
        background: #f56c6c;
      }
      .status.loading {
        background: #e6a23c;
      }
      button {
        background: #409eff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #337ab7;
      }
      .log {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 5px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš€ AkashicHub é€£æ¥æ¸¬è©¦</h1>

      <div class="success">
        <strong>âœ… éœæ…‹æ–‡ä»¶æœå‹™æ­£å¸¸ï¼</strong><br />
        å¦‚æœæ‚¨èƒ½çœ‹åˆ°é€™å€‹é é¢ï¼Œèªªæ˜ Vite é–‹ç™¼æœå‹™å™¨å·²ç¶“æˆåŠŸå•Ÿå‹•ä¸¦èƒ½å¤ æä¾›éœæ…‹æ–‡ä»¶æœå‹™ã€‚
      </div>

      <div class="info">
        <strong>ğŸ“‹ ç³»çµ±è³‡è¨Š</strong><br />
        ç•¶å‰æ™‚é–“: <span id="currentTime"></span><br />
        ç”¨æˆ¶ä»£ç†: <span id="userAgent"></span><br />
        é é¢URL: <span id="pageUrl"></span><br />
        å”è­°: <span id="protocol"></span>
      </div>

      <h2>ğŸ”§ é€£æ¥æ¸¬è©¦</h2>

      <div class="test-item">
        <strong>ä¸»æ‡‰ç”¨è¨ªå•æ¸¬è©¦:</strong>
        <span id="appStatus" class="status loading">æ¸¬è©¦ä¸­...</span>
        <button onclick="testApp()">é‡æ–°æ¸¬è©¦</button>
      </div>

      <div class="test-item">
        <strong>APIé€£æ¥æ¸¬è©¦:</strong>
        <span id="apiStatus" class="status loading">æ¸¬è©¦ä¸­...</span>
        <button onclick="testAPI()">é‡æ–°æ¸¬è©¦</button>
      </div>

      <div class="test-item">
        <strong>WebSocketæ¸¬è©¦:</strong>
        <span id="wsStatus" class="status loading">æ¸¬è©¦ä¸­...</span>
        <button onclick="testWebSocket()">é‡æ–°æ¸¬è©¦</button>
      </div>

      <h2>ğŸŒ æ›¿ä»£è¨ªå•åœ°å€</h2>
      <div class="test-item">
        <p>å¦‚æœ localhost ç„¡æ³•è¨ªå•ï¼Œè«‹å˜—è©¦ä»¥ä¸‹åœ°å€:</p>
        <ul>
          <li><a href="http://127.0.0.1:5173/" target="_blank">http://127.0.0.1:5173/</a></li>
          <li><a href="http://0.0.0.0:5173/" target="_blank">http://0.0.0.0:5173/</a></li>
          <li id="networkAddresses">æª¢æ¸¬ä¸­...</li>
        </ul>
      </div>

      <h2>ğŸ” æ•…éšœæ’é™¤</h2>
      <div class="test-item">
        <button onclick="runDiagnostics()">é‹è¡Œè¨ºæ–·</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
      </div>

      <div id="logContainer" class="log"></div>
    </div>

    <script>
      let logContainer = document.getElementById('logContainer')

      function log(message) {
        const timestamp = new Date().toLocaleTimeString()
        logContainer.textContent += `[${timestamp}] ${message}\n`
        logContainer.scrollTop = logContainer.scrollHeight
      }

      function updateStatus(elementId, status, text) {
        const element = document.getElementById(elementId)
        element.className = `status ${status}`
        element.textContent = text
      }

      function clearLog() {
        logContainer.textContent = ''
      }

      // æ›´æ–°ç³»çµ±è³‡è¨Š
      document.getElementById('currentTime').textContent = new Date().toLocaleString()
      document.getElementById('userAgent').textContent = navigator.userAgent
      document.getElementById('pageUrl').textContent = window.location.href
      document.getElementById('protocol').textContent = window.location.protocol

      // æ¸¬è©¦ä¸»æ‡‰ç”¨
      async function testApp() {
        log('æ¸¬è©¦ä¸»æ‡‰ç”¨é€£æ¥...')
        updateStatus('appStatus', 'loading', 'æ¸¬è©¦ä¸­...')

        try {
          const response = await fetch('/')
          if (response.ok) {
            const text = await response.text()
            if (text.includes('è¼‰å…¥ä¸­') || text.includes('app')) {
              updateStatus('appStatus', 'ok', 'æ­£å¸¸')
              log('âœ… ä¸»æ‡‰ç”¨é€£æ¥æ­£å¸¸')
            } else {
              updateStatus('appStatus', 'error', 'å…§å®¹ç•°å¸¸')
              log('âš ï¸ ä¸»æ‡‰ç”¨è¿”å›äº†ç•°å¸¸å…§å®¹')
            }
          } else {
            updateStatus('appStatus', 'error', `éŒ¯èª¤: ${response.status}`)
            log(`âŒ ä¸»æ‡‰ç”¨é€£æ¥å¤±æ•—: ${response.status}`)
          }
        } catch (error) {
          updateStatus('appStatus', 'error', 'é€£æ¥å¤±æ•—')
          log(`âŒ ä¸»æ‡‰ç”¨é€£æ¥éŒ¯èª¤: ${error.message}`)
        }
      }

      // æ¸¬è©¦API
      async function testAPI() {
        log('æ¸¬è©¦APIé€£æ¥...')
        updateStatus('apiStatus', 'loading', 'æ¸¬è©¦ä¸­...')

        try {
          const response = await fetch('http://localhost:3000/api/health')
          if (response.ok) {
            updateStatus('apiStatus', 'ok', 'æ­£å¸¸')
            log('âœ… APIé€£æ¥æ­£å¸¸')
          } else {
            updateStatus('apiStatus', 'error', `éŒ¯èª¤: ${response.status}`)
            log(`âš ï¸ APIé€£æ¥å¤±æ•—: ${response.status} (é€™å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœå¾Œç«¯æœªå•Ÿå‹•)`)
          }
        } catch (error) {
          updateStatus('apiStatus', 'error', 'é€£æ¥å¤±æ•—')
          log(`âš ï¸ APIé€£æ¥éŒ¯èª¤: ${error.message} (é€™å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœå¾Œç«¯æœªå•Ÿå‹•)`)
        }
      }

      // æ¸¬è©¦WebSocket
      function testWebSocket() {
        log('æ¸¬è©¦WebSocketé€£æ¥...')
        updateStatus('wsStatus', 'loading', 'æ¸¬è©¦ä¸­...')

        try {
          const ws = new WebSocket('ws://localhost:3000')

          ws.onopen = () => {
            updateStatus('wsStatus', 'ok', 'æ­£å¸¸')
            log('âœ… WebSocketé€£æ¥æ­£å¸¸')
            ws.close()
          }

          ws.onerror = error => {
            updateStatus('wsStatus', 'error', 'é€£æ¥å¤±æ•—')
            log(`âš ï¸ WebSocketé€£æ¥éŒ¯èª¤ (é€™å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœå¾Œç«¯æœªå•Ÿå‹•)`)
          }

          ws.onclose = () => {
            log('WebSocketé€£æ¥å·²é—œé–‰')
          }

          // 5ç§’å¾Œè¶…æ™‚
          setTimeout(() => {
            if (ws.readyState === WebSocket.CONNECTING) {
              ws.close()
              updateStatus('wsStatus', 'error', 'è¶…æ™‚')
              log('âŒ WebSocketé€£æ¥è¶…æ™‚')
            }
          }, 5000)
        } catch (error) {
          updateStatus('wsStatus', 'error', 'é€£æ¥å¤±æ•—')
          log(`âŒ WebSocketéŒ¯èª¤: ${error.message}`)
        }
      }

      // é‹è¡Œè¨ºæ–·
      function runDiagnostics() {
        log('=== é–‹å§‹è¨ºæ–· ===')
        log(`ç€è¦½å™¨: ${navigator.userAgent}`)
        log(`é é¢URL: ${window.location.href}`)
        log(`å”è­°: ${window.location.protocol}`)
        log(`ä¸»æ©Ÿ: ${window.location.host}`)
        log(`ç«¯å£: ${window.location.port}`)
        log(`è·¯å¾‘: ${window.location.pathname}`)
        log(`åœ¨ç·šç‹€æ…‹: ${navigator.onLine ? 'åœ¨ç·š' : 'é›¢ç·š'}`)
        log(`èªè¨€: ${navigator.language}`)
        log(`å¹³å°: ${navigator.platform}`)
        log(`Cookieå•Ÿç”¨: ${navigator.cookieEnabled ? 'æ˜¯' : 'å¦'}`)
        log(`Javaå•Ÿç”¨: ${navigator.javaEnabled() ? 'æ˜¯' : 'å¦'}`)
        log(`å±å¹•è§£æåº¦: ${screen.width}x${screen.height}`)
        log(`è¦–çª—å¤§å°: ${window.innerWidth}x${window.innerHeight}`)
        log('=== è¨ºæ–·å®Œæˆ ===')
      }

      // æª¢æ¸¬ç¶²çµ¡åœ°å€
      function detectNetworkAddresses() {
        const addresses = []
        return
        // å˜—è©¦å¸¸è¦‹çš„ç§æœ‰IPç¯„åœ
        const commonRanges = [
          '192.168.1',
          '192.168.0',
          '192.168.2',
          '10.0.0',
          '172.16.0',
          '172.17.0',
        ]

        let addressesHtml = ''
        for (let i = 1; i <= 254; i++) {
          commonRanges.forEach(range => {
            const ip = `${range}.${i}`
            addressesHtml += `<li><a href="http://${ip}:5173/" target="_blank">http://${ip}:5173/</a></li>`
          })
        }

        document.getElementById('networkAddresses').innerHTML =
          '<p>å¸¸è¦‹ç¶²çµ¡åœ°å€ (è«‹å˜—è©¦èˆ‡æ‚¨çš„IPåœ°å€åŒ¹é…çš„åœ°å€):</p><ul>' + addressesHtml + '</ul>'
      }

      // åˆå§‹åŒ–æ¸¬è©¦
      window.onload = function () {
        log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹æ¸¬è©¦...')
        testApp()
        testAPI()
        testWebSocket()
        detectNetworkAddresses()
      }
    </script>
  </body>
</html>
